define("kg/wf/5.0.0/lib/base",["node","base","util"],function(t,e,a){function i(){var t=this;i.superclass.constructor.apply(t,arguments);var e=t.__onResize=g.buffer(r,h,t);r.call(t),f(d).on("resize",e)}function n(t,e,a,i){function n(){s=[].concat(g.makeArray(t)),s.length>0?!function(){var n=+new Date;do{var l=s.shift();e.call(a,l)}while(s.length>0&&+new Date-n<50);s.length>0?r=setTimeout(arguments.callee,25):i&&i.call(a,t)}():i&&i.call(a,t)}var r,s,l={};return l.stop=function(){r&&(clearTimeout(r),s=[],t.each(function(t){t.stop()}))},l.start=n,l}function r(){var t=this,e=t.get("colWidth"),a=t.get("container"),i=t._containerRegion||{};g.isFunction(e)&&(e=e(t)),!a[0].offsetWidth||t._colWidth===e&&a.width()===i.width||(t._colWidth=e,t.adjust())}function s(){var t=this,e=t.get("container"),a=e.width(),i=t._curColHeights||[];t._curColHeights=i,i.length=Math.max(Math.floor(a/t._colWidth),t.get("minColCount")),t._containerRegion={width:a},g.each(i,function(t,e){i[e]=0}),t._colItems=[]}function l(t,e,a,i){function n(e){u[_]+=c.outerHeight(!0);var a=t._colItems;a[_]=a[_]||[],a[_].push(c),c.attr("data-waterfall-col",_);var n=c[0].className.replace(/\s*ks-waterfall-col-(?:first|last|\d+)/g,"");n+=" ks-waterfall-col-"+_,0==_?n+=" ks-waterfall-col-first":_==u.length-1&&(n+=" ks-waterfall-col-last"),c[0].className=n,e||i&&i()}var r,s,l=t.get("effect"),c=f(a),o=t.get("align"),u=t._curColHeights,d=t.get("container"),h=t._colWidth,g=u.length,_=0,p=t._containerRegion,v=Number.MAX_VALUE;if(!g)return void 0;if(c.hasClass("ks-waterfall-fixed-left"))_=0;else if(c.hasClass("ks-waterfall-fixed-right"))_=g>0?g-1:0;else for(var m=0;g>m;m++)u[m]<v&&(v=u[m],_=m);if(r="left"===o?0:Math.max(p.width-g*h,0),"center"===o&&(r/=2),"justify"===o&&g>1&&(r=_>0?Math.max((p.width-h)/(g-1)-h,0)*_:0),s={left:_*h+r,top:u[_]},e)c.css(s),l&&l.effect&&c.css("visibility","hidden"),d.append(c),n();else{var j=t.get("adjustEffect");j?(n(1),c.animate(s,j.duration,j.easing,i)):(c.css(s),n())}return c}function c(t){var e=this,a=l(e,!0,t),i=e.get("effect");a&&i&&i.effect&&(a.hide(),a.css("visibility",""),a[i.effect](i.duration,0,i.easing))}var o=t("node"),u=t("base"),f=o.all,d=window,h=50,g=t("util");i.ATTRS={container:{setter:function(t){return f(t)}},align:{value:"center"},minColCount:{value:1},effect:{value:{effect:"fadeIn",duration:1}},colWidth:{},adjustEffect:{}},g.extend(i,u,{isAdjusting:function(){return!!this._adjuster},isAdding:function(){return!!this._adder},adjustItem:function(t,e){function a(){p--,0>=p&&(i._adjuster=0,e.callback&&e.callback.call(i))}var i=this;if(e=e||{},i.isAdjusting())return void 0;var r,s=t.outerHeight(!0);e.process&&(r=e.process.call(i)),void 0===r&&(r=t.outerHeight(!0));for(var l,c=r-s,o=i._curColHeights,u=parseInt(t.attr("data-waterfall-col")),f=i._colItems[u],d=[],h=Math.max.apply(Math,o),g=0;g<f.length&&f[g][0]!==t[0];g++);for(g++;g<f.length;)d.push(f[g]),g++;o[u]+=c,l=Math.max.apply(Math,o),l!=h&&i.get("container").height(l);var _=e.effect,p=d.length;return p?(void 0===_&&(_=i.get("adjustEffect")),i._adjuster=n(d,function(t){_?t.animate({top:parseInt(t.css("top"))+c},_.duration,_.easing,a):(t.css("top",parseInt(t.css("top"))+c),a())}),i._adjuster.start(),i._adjuster):e.callback&&e.callback.call(i)},removeItem:function(t,e){e=e||{};var a=this,i=e.callback;a.adjustItem(t,g.mix(e,{process:function(){return t.remove(),0},callback:function(){for(var e=parseInt(t.attr("data-waterfall-col")),n=a._colItems[e],r=0;r<n.length;r++)if(n[r][0]==t[0]){n.splice(r,1);break}i&&i()}}))},adjust:function(t){function e(){r--,0>=r&&(a.get("container").height(Math.max.apply(Math,a._curColHeights)),a._adjuster=0,t&&t.call(a),a.fire("adjustComplete",{items:i}))}var a=this,i=a.get("container").all(".ks-waterfall");a.isAdjusting()&&(a._adjuster.stop(),a._adjuster=0),s.call(a);var r=i.length;return r?(a._adjuster=n(i,function(t){l(a,!1,t,e)}),a._adjuster.start(),a._adjuster):t&&t.call(a)},addItems:function(t,e){var a=this;return a._adder=n(t,c,a,function(){a.get("container").height(Math.max.apply(Math,a._curColHeights)),a._adder=0,e&&e.call(a),a.fire("addComplete",{items:t})}),a._adder.start(),a._adder},destroy:function(){var t=this,e=t.__onResize;f(d).detach("resize",e),e.stop(),t.fire("destroy"),t.__destroyed=1}}),a.exports=i});